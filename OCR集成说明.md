# 病例导入OCR功能集成说明

## ✨ 功能概述
为病例导入功能的第4、5步添加了**OCR文字识别功能**，可以自动提取上传照片中的文字并填充到"报告内容"文本框中。

## 🏗️ 架构设计
```
微信小程序 → OCR API服务 → ocrflux服务 → 返回识别结果
```

## 🚀 快速部署

### 1. 确认环境
确保你的服务器（10.91.11.250）上ocrflux服务正常运行在24866端口。

### 2. 安装依赖
```bash
pip install Flask Flask-CORS ocrflux
```

### 3. 部署API服务
将 `ocr_api.py` 上传到服务器并运行：
```bash
python ocr_api.py
```

### 4. 验证服务
访问 `http://10.91.11.250:5000/health` 确认服务正常。

## 📱 功能说明

### 自动识别流程
1. **上传照片** → 显示"照片添加成功"
2. **自动OCR** → 显示"正在识别文字..."
3. **识别完成** → 显示"文字识别成功"，自动填充到文本框
4. **多张照片** → 识别结果追加显示，用空行分隔

### 适用场景
- ✅ **第4步**: 影像学报告照片 → 自动提取B超等检查报告文字
- ✅ **第5步**: 病理报告照片 → 自动提取病理诊断文字

## ⚙️ 配置修改

### 服务器配置
如需修改服务器地址，编辑 `ocr_api.py` 中的：
```python
url="http://你的服务器IP",    # ocrflux服务地址
port=24866,                  # ocrflux服务端口
```

### 小程序配置  
如需修改API地址，编辑 `case-import.js` 中的：
```javascript
url: 'http://你的服务器IP:5000/ocr'
```

## 🔧 注意事项

1. **防火墙**: 确保服务器开放5000端口
2. **域名白名单**: 在微信小程序后台配置服务器域名
3. **网络连接**: 确保小程序能访问你的服务器地址

## 🎯 功能特点

- ✅ **自动识别**: 照片上传后立即开始OCR识别
- ✅ **智能追加**: 多张照片的识别结果自动合并
- ✅ **错误处理**: 完善的错误提示和异常处理
- ✅ **用户友好**: 加载动画和成功提示
- ✅ **高准确性**: 基于ocrflux的专业OCR引擎