<!--case-list.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨ç»Ÿè®¡ -->
  <view class="stats-header">
    <view class="stats-item">
      <view class="stats-number">{{caseList.length}}</view>
      <view class="stats-label">æ€»ç—…ä¾‹</view>
    </view>
    <view class="stats-item">
      <view class="stats-number">{{todayCount}}</view>
      <view class="stats-label">ä»Šæ—¥æ–°å¢</view>
    </view>
    <view class="stats-item">
      <view class="stats-number">{{recentCount}}</view>
      <view class="stats-label">è¿‘7å¤©</view>
    </view>
  </view>

  <!-- æœç´¢å’Œç­›é€‰ -->
  <view class="search-section">
    <view class="search-bar">
      <input class="search-input" 
             placeholder="æœç´¢ç—…ä¾‹..." 
             value="{{searchKeyword}}"
             bindinput="onSearchInput"
             confirm-type="search"
             bindconfirm="onSearch" />
      <view class="search-icon">ğŸ”</view>
    </view>
    <view class="filter-tabs">
      <view class="filter-tab {{activeFilter === 'all' ? 'active' : ''}}" 
            bindtap="onFilterChange" data-filter="all">
        å…¨éƒ¨
      </view>
      <view class="filter-tab {{activeFilter === 'today' ? 'active' : ''}}" 
            bindtap="onFilterChange" data-filter="today">
        ä»Šæ—¥
      </view>
      <view class="filter-tab {{activeFilter === 'week' ? 'active' : ''}}" 
            bindtap="onFilterChange" data-filter="week">
        æœ¬å‘¨
      </view>
    </view>
  </view>

  <!-- ç—…ä¾‹åˆ—è¡¨ -->
  <view class="case-list-section">
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{filteredCaseList.length === 0 && !isLoading}}">
      <view class="empty-icon">ğŸ“‹</view>
      <view class="empty-title">{{searchKeyword ? 'æ²¡æœ‰æ‰¾åˆ°ç›¸å…³ç—…ä¾‹' : 'æš‚æ— ç—…ä¾‹è®°å½•'}}</view>
      <view class="empty-desc">{{searchKeyword ? 'å°è¯•ä½¿ç”¨å…¶ä»–å…³é”®è¯æœç´¢' : 'ç‚¹å‡»å³ä¸‹è§’æŒ‰é’®å¼€å§‹å½•å…¥ç¬¬ä¸€ä¸ªç—…ä¾‹'}}</view>
      <button class="btn btn-primary" wx:if="{{!searchKeyword}}" bindtap="navigateToNewCase">
        æ–°å»ºç—…ä¾‹
      </button>
    </view>

    <!-- ç—…ä¾‹å¡ç‰‡åˆ—è¡¨ -->
    <view class="case-item card" 
          wx:for="{{filteredCaseList}}" wx:key="id"
          bindtap="navigateToCaseDetail" data-id="{{item.id}}">
      <view class="case-header">
        <view class="case-info">
          <view class="case-title">
            ç—…ä¾‹ #{{item.id.slice(-6)}}
          </view>
          <view class="case-meta">
            <text class="case-gender">{{item.basicInfo.gender}}</text>
            <text class="case-age">{{item.basicInfo.age}}å²</text>
            <text class="case-time">{{item.createTimeText}}</text>
          </view>
        </view>
        <view class="case-status">
          <text class="badge {{item.status === 'completed' ? 'badge-success' : 'badge-warning'}}">
            {{item.status === 'completed' ? 'å·²å®Œæˆ' : 'è‰ç¨¿'}}
          </text>
        </view>
      </view>

      <view class="case-content">
        <!-- ç—‡çŠ¶ä¿¡æ¯ -->
        <view class="case-detail-item" wx:if="{{item.symptoms.duration && item.symptoms.durationUnit}}">
          <view class="detail-label">ç—‡çŠ¶æ—¶é—´ï¼š</view>
          <view class="detail-value">{{item.symptoms.duration}}{{item.symptoms.durationUnit}}</view>
        </view>

        <!-- åˆå¹¶ç–¾ç—… -->
        <view class="case-detail-item" wx:if="{{item.comorbidities.length > 0}}">
          <view class="detail-label">åˆå¹¶ç–¾ç—…ï¼š</view>
          <view class="detail-value">{{item.comorbiditiesText}}</view>
        </view>

        <!-- æ—¢å¾€ç—…å² -->
        <view class="case-detail-item" wx:if="{{item.pastHistory.length > 0}}">
          <view class="detail-label">æ—¢å¾€ç—…å²ï¼š</view>
          <view class="detail-value">{{item.pastHistoryText}}</view>
        </view>

        <!-- æŠ¥å‘Šæ–‡ä»¶æ•°é‡ -->
        <view class="case-files" wx:if="{{item.totalFiles > 0}}">
          <view class="file-count">
            <text class="file-icon">ğŸ“</text>
            <text class="file-text">{{item.totalFiles}}ä¸ªæ–‡ä»¶</text>
          </view>
        </view>
      </view>

      <view class="case-footer">
        <view class="case-actions">
          <button class="btn-small btn-secondary" 
                  bindtap="editCase" data-id="{{item.id}}"
                  catchtap="true">
            ç¼–è¾‘
          </button>
          <button class="btn-small btn-primary" 
                  bindtap="shareCase" data-id="{{item.id}}"
                  catchtap="true">
            åˆ†äº«
          </button>
          <button class="btn-small btn-danger" 
                  bindtap="deleteCase" data-id="{{item.id}}"
                  catchtap="true">
            åˆ é™¤
          </button>
        </view>
      </view>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading" wx:if="{{isLoading}}">
      <view class="loading-spinner"></view>
      <view class="loading-text">åŠ è½½ä¸­...</view>
    </view>
  </view>

  <!-- æµ®åŠ¨æ–°å»ºæŒ‰é’® -->
  <view class="fab" bindtap="navigateToNewCase">
    <text class="fab-icon">+</text>
  </view>
</view>
