<!--case-list.wxml-->
<view class="container">
  <!-- 顶部统计 -->
  <view class="stats-header">
    <view class="stats-item">
      <view class="stats-number">{{caseList.length}}</view>
      <view class="stats-label">总病例</view>
    </view>
    <view class="stats-item">
      <view class="stats-number">{{todayCount}}</view>
      <view class="stats-label">今日新增</view>
    </view>
    <view class="stats-item">
      <view class="stats-number">{{recentCount}}</view>
      <view class="stats-label">近7天</view>
    </view>
  </view>

  <!-- 搜索和筛选 -->
  <view class="search-section">
    <view class="search-bar">
      <input class="search-input" 
             placeholder="搜索病例..." 
             value="{{searchKeyword}}"
             bindinput="onSearchInput"
             confirm-type="search"
             bindconfirm="onSearch" />
      <view class="search-icon">🔍</view>
    </view>
    <view class="filter-tabs">
      <view class="filter-tab {{activeFilter === 'all' ? 'active' : ''}}" 
            bindtap="onFilterChange" data-filter="all">
        全部
      </view>
      <view class="filter-tab {{activeFilter === 'today' ? 'active' : ''}}" 
            bindtap="onFilterChange" data-filter="today">
        今日
      </view>
      <view class="filter-tab {{activeFilter === 'week' ? 'active' : ''}}" 
            bindtap="onFilterChange" data-filter="week">
        本周
      </view>
    </view>
  </view>

  <!-- 病例列表 -->
  <view class="case-list-section">
    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{filteredCaseList.length === 0 && !isLoading}}">
      <view class="empty-icon">📋</view>
      <view class="empty-title">{{searchKeyword ? '没有找到相关病例' : '暂无病例记录'}}</view>
      <view class="empty-desc">{{searchKeyword ? '尝试使用其他关键词搜索' : '点击右下角按钮开始录入第一个病例'}}</view>
      <button class="btn btn-primary" wx:if="{{!searchKeyword}}" bindtap="navigateToNewCase">
        新建病例
      </button>
    </view>

    <!-- 病例卡片列表 -->
    <view class="case-item card" 
          wx:for="{{filteredCaseList}}" wx:key="id"
          bindtap="navigateToCaseDetail" data-id="{{item.id}}">
      <view class="case-header">
        <view class="case-info">
          <view class="case-title">
            病例 #{{item.id.slice(-6)}}
          </view>
          <view class="case-meta">
            <text class="case-gender">{{item.basicInfo.gender}}</text>
            <text class="case-age">{{item.basicInfo.age}}岁</text>
            <text class="case-time">{{item.createTimeText}}</text>
          </view>
        </view>
        <view class="case-status">
          <text class="badge {{item.status === 'completed' ? 'badge-success' : 'badge-warning'}}">
            {{item.status === 'completed' ? '已完成' : '草稿'}}
          </text>
        </view>
      </view>

      <view class="case-content">
        <!-- 症状信息 -->
        <view class="case-detail-item" wx:if="{{item.symptoms.duration && item.symptoms.durationUnit}}">
          <view class="detail-label">症状时间：</view>
          <view class="detail-value">{{item.symptoms.duration}}{{item.symptoms.durationUnit}}</view>
        </view>

        <!-- 合并疾病 -->
        <view class="case-detail-item" wx:if="{{item.comorbidities.length > 0}}">
          <view class="detail-label">合并疾病：</view>
          <view class="detail-value">{{item.comorbiditiesText}}</view>
        </view>

        <!-- 既往病史 -->
        <view class="case-detail-item" wx:if="{{item.pastHistory.length > 0}}">
          <view class="detail-label">既往病史：</view>
          <view class="detail-value">{{item.pastHistoryText}}</view>
        </view>

        <!-- 报告文件数量 -->
        <view class="case-files" wx:if="{{item.totalFiles > 0}}">
          <view class="file-count">
            <text class="file-icon">📎</text>
            <text class="file-text">{{item.totalFiles}}个文件</text>
          </view>
        </view>
      </view>

      <view class="case-footer">
        <view class="case-actions">
          <button class="btn-small btn-secondary" 
                  bindtap="editCase" data-id="{{item.id}}"
                  catchtap="true">
            编辑
          </button>
          <button class="btn-small btn-primary" 
                  bindtap="shareCase" data-id="{{item.id}}"
                  catchtap="true">
            分享
          </button>
          <button class="btn-small btn-danger" 
                  bindtap="deleteCase" data-id="{{item.id}}"
                  catchtap="true">
            删除
          </button>
        </view>
      </view>
    </view>

    <!-- 加载状态 -->
    <view class="loading" wx:if="{{isLoading}}">
      <view class="loading-spinner"></view>
      <view class="loading-text">加载中...</view>
    </view>
  </view>

  <!-- 浮动新建按钮 -->
  <view class="fab" bindtap="navigateToNewCase">
    <text class="fab-icon">+</text>
  </view>
</view>
