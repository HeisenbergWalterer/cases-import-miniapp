<!--case-entry.wxml-->
<view class="container">
  <!-- è¿›åº¦æ¡ -->
  <view class="progress-section">
    <view class="progress-header">
      <view class="progress-title">ç—…ä¾‹å½•å…¥</view>
      <view class="progress-desc">ç¬¬{{currentStep}}æ­¥ï¼Œå…±6æ­¥</view>
    </view>
    <view class="progress">
      <view class="progress-bar" style="width: {{(currentStep/6*100)}}%"></view>
    </view>
    <view class="step-indicators">
      <view class="step-indicator {{index < currentStep ? 'completed' : index === currentStep - 1 ? 'active' : ''}}" 
            wx:for="{{steps}}" wx:key="index">
        <view class="step-number">{{index + 1}}</view>
        <view class="step-label">{{item}}</view>
      </view>
    </view>
  </view>

  <!-- è¡¨å•å†…å®¹åŒºåŸŸ -->
  <view class="form-section">
    <!-- ç¬¬1æ­¥ï¼šåŸºæœ¬ä¿¡æ¯ -->
    <view class="step-content" wx:if="{{currentStep === 1}}">
      <view class="section-title">åŸºæœ¬ä¿¡æ¯</view>
      
      <view class="form-group">
        <view class="form-label">æ€§åˆ« <text class="required">*</text></view>
        <view class="radio-group">
          <view class="radio-item {{formData.basicInfo.gender === 'ç”·' ? 'checked' : ''}}" 
                bindtap="onGenderChange" data-value="ç”·">
            <view class="radio-icon">{{formData.basicInfo.gender === 'ç”·' ? 'â—' : 'â—‹'}}</view>
            <view class="radio-label">ç”·</view>
          </view>
          <view class="radio-item {{formData.basicInfo.gender === 'å¥³' ? 'checked' : ''}}" 
                bindtap="onGenderChange" data-value="å¥³">
            <view class="radio-icon">{{formData.basicInfo.gender === 'å¥³' ? 'â—' : 'â—‹'}}</view>
            <view class="radio-label">å¥³</view>
          </view>
        </view>
        <view class="error-message" wx:if="{{errors.gender}}">{{errors.gender}}</view>
      </view>

      <view class="form-group">
        <view class="form-label">å¹´é¾„ <text class="required">*</text></view>
        <input class="form-control {{errors.age ? 'error' : ''}}" 
               type="number" 
               placeholder="è¯·è¾“å…¥å¹´é¾„" 
               value="{{formData.basicInfo.age}}"
               bindinput="onAgeInput"
               maxlength="3" />
        <view class="form-hint">è¯·è¾“å…¥0-120ä¹‹é—´çš„å¹´é¾„</view>
        <view class="error-message" wx:if="{{errors.age}}">{{errors.age}}</view>
      </view>
    </view>

    <!-- ç¬¬2æ­¥ï¼šç—‡çŠ¶ä¿¡æ¯ -->
    <view class="step-content" wx:if="{{currentStep === 2}}">
      <view class="section-title">ç—‡çŠ¶ä¿¡æ¯</view>
      
      <view class="form-group">
        <view class="form-label">å‘ç°èƒ†å›Šç»“çŸ³/æ¯è‚‰/è…¹ç—›ç­‰ç—‡çŠ¶å‡ºç°æ—¶é—´ <text class="required">*</text></view>
        <view class="duration-input">
          <input class="form-control duration-number {{errors.duration ? 'error' : ''}}" 
                 type="number" 
                 placeholder="æ—¶é—´" 
                 value="{{formData.symptoms.duration}}"
                 bindinput="onDurationInput" />
          <picker class="duration-unit" 
                  range="{{durationUnits}}" 
                  value="{{durationUnitIndex}}"
                  bindchange="onDurationUnitChange">
            <view class="picker-display {{!formData.symptoms.durationUnit ? 'placeholder' : ''}}">
              {{formData.symptoms.durationUnit || 'å•ä½'}}
            </view>
          </picker>
        </view>
        <view class="form-hint">è¯·é€‰æ‹©ç—‡çŠ¶å‡ºç°çš„æ—¶é—´é•¿åº¦</view>
        <view class="error-message" wx:if="{{errors.duration || errors.durationUnit}}">
          {{errors.duration || errors.durationUnit}}
        </view>
      </view>
    </view>

    <!-- ç¬¬3æ­¥ï¼šåˆå¹¶ç–¾ç—… -->
    <view class="step-content" wx:if="{{currentStep === 3}}">
      <view class="section-title">åˆå¹¶ç–¾ç—…</view>
      <view class="form-hint mb-24">è¯·é€‰æ‹©æ‚£è€…ç°æœ‰çš„åˆå¹¶ç–¾ç—…ï¼ˆå¯å¤šé€‰ï¼‰</view>
      
      <view class="checkbox-grid">
        <view class="checkbox-item {{item.checked ? 'checked' : ''}}" 
              wx:for="{{comorbidityOptions}}" wx:key="value"
              bindtap="onComorbidityChange" data-value="{{item.value}}">
          <view class="checkbox-icon">{{item.checked ? 'â˜‘' : 'â˜'}}</view>
          <view class="checkbox-label">{{item.label}}</view>
        </view>
      </view>
    </view>

    <!-- ç¬¬4æ­¥ï¼šæ—¢å¾€ç—…å² -->
    <view class="step-content" wx:if="{{currentStep === 4}}">
      <view class="section-title">æ—¢å¾€æ›¾æœ‰çš„èƒ†å›Šç›¸å…³ç–¾ç—…ã€å¹¶å‘ç—‡å²</view>
      <view class="form-hint mb-24">è¯·é€‰æ‹©æ‚£è€…æ—¢å¾€ç›¸å…³ç—…å²ï¼ˆå¯å¤šé€‰ï¼‰</view>
      
      <view class="checkbox-grid">
        <view class="checkbox-item {{item.checked ? 'checked' : ''}}" 
              wx:for="{{pastHistoryOptions}}" wx:key="value"
              bindtap="onPastHistoryChange" data-value="{{item.value}}">
          <view class="checkbox-icon">{{item.checked ? 'â˜‘' : 'â˜'}}</view>
          <view class="checkbox-label">{{item.label}}</view>
        </view>
      </view>
    </view>

    <!-- ç¬¬5æ­¥ï¼šå½±åƒå­¦æŠ¥å‘Š -->
    <view class="step-content" wx:if="{{currentStep === 5}}">
      <view class="section-title">å½±åƒå­¦æŠ¥å‘Šï¼ˆBè¶…ï¼‰</view>
      
      <view class="form-group">
        <view class="form-label">ä¸Šä¼ æŠ¥å‘Šæ–‡ä»¶</view>
        <view class="file-upload-area" bindtap="chooseImagingFile">
          <view class="upload-icon">ğŸ“</view>
          <view class="upload-text">ç‚¹å‡»ä¸Šä¼ å½±åƒå­¦æŠ¥å‘Š</view>
          <view class="upload-hint">æ”¯æŒå›¾ç‰‡å’ŒPDFæ–‡ä»¶ï¼Œæœ€å¤§10MB</view>
        </view>
        <view class="file-list" wx:if="{{formData.imagingReport.files.length > 0}}">
          <view class="file-item" wx:for="{{formData.imagingReport.files}}" wx:key="index">
            <view class="file-info">
              <view class="file-name">{{item.name}}</view>
              <view class="file-size">{{item.sizeText}}</view>
            </view>
            <view class="file-actions">
              <text class="file-remove" bindtap="removeImagingFile" data-index="{{index}}">åˆ é™¤</text>
            </view>
          </view>
        </view>
      </view>

      <view class="form-group">
        <view class="form-label">è¯¦ç»†æŠ¥å‘Š</view>
        <textarea class="form-control textarea" 
                  placeholder="è¯·è¾“å…¥Bè¶…æ£€æŸ¥çš„è¯¦ç»†æŠ¥å‘Šå†…å®¹..."
                  value="{{formData.imagingReport.detailReport}}"
                  bindinput="onDetailReportInput"
                  maxlength="1000" />
        <view class="char-count">{{formData.imagingReport.detailReport.length}}/1000</view>
      </view>

      <view class="form-group">
        <view class="form-label">æ£€æŸ¥ç»“è®º</view>
        <textarea class="form-control textarea" 
                  placeholder="è¯·è¾“å…¥æ£€æŸ¥ç»“è®º..."
                  value="{{formData.imagingReport.conclusion}}"
                  bindinput="onConclusionInput"
                  maxlength="500" />
        <view class="char-count">{{formData.imagingReport.conclusion.length}}/500</view>
      </view>
    </view>

    <!-- ç¬¬6æ­¥ï¼šç—…ç†æŠ¥å‘Š -->
    <view class="step-content" wx:if="{{currentStep === 6}}">
      <view class="section-title">ç—…ç†æŠ¥å‘Š</view>
      
      <view class="form-group">
        <view class="form-label">ä¸Šä¼ ç—…ç†æŠ¥å‘Šæ–‡ä»¶</view>
        <view class="file-upload-area" bindtap="choosePathologyFile">
          <view class="upload-icon">ğŸ“</view>
          <view class="upload-text">ç‚¹å‡»ä¸Šä¼ ç—…ç†æŠ¥å‘Š</view>
          <view class="upload-hint">æ”¯æŒå›¾ç‰‡å’ŒPDFæ–‡ä»¶ï¼Œæœ€å¤§10MB</view>
        </view>
        <view class="file-list" wx:if="{{formData.pathologyReport.files.length > 0}}">
          <view class="file-item" wx:for="{{formData.pathologyReport.files}}" wx:key="index">
            <view class="file-info">
              <view class="file-name">{{item.name}}</view>
              <view class="file-size">{{item.sizeText}}</view>
            </view>
            <view class="file-actions">
              <text class="file-remove" bindtap="removePathologyFile" data-index="{{index}}">åˆ é™¤</text>
            </view>
          </view>
        </view>
      </view>

      <view class="form-group">
        <view class="form-label">ç—…ç†è¯Šæ–­æŠ¥å‘Š</view>
        <textarea class="form-control textarea" 
                  placeholder="è¯·è¾“å…¥ç—…ç†è¯Šæ–­æŠ¥å‘Šå†…å®¹..."
                  value="{{formData.pathologyReport.diagnosis}}"
                  bindinput="onDiagnosisInput"
                  maxlength="1000" />
        <view class="char-count">{{formData.pathologyReport.diagnosis.length}}/1000</view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="footer-actions safe-area">
    <button class="btn btn-secondary" wx:if="{{currentStep > 1}}" bindtap="prevStep">ä¸Šä¸€æ­¥</button>
    <button class="btn btn-primary" bindtap="saveDraft">ä¿å­˜è‰ç¨¿</button>
    <button class="btn btn-primary" wx:if="{{currentStep < 6}}" bindtap="nextStep">ä¸‹ä¸€æ­¥</button>
    <button class="btn btn-success" wx:if="{{currentStep === 6}}" bindtap="submitForm">æäº¤ç—…ä¾‹</button>
  </view>
</view>
