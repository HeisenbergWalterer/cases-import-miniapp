<!--case-detail.wxml-->
<view class="container">
  <!-- ç—…ä¾‹å¤´éƒ¨ä¿¡æ¯ -->
  <view class="case-header card">
    <view class="header-content">
      <view class="case-title">
        ç—…ä¾‹ #{{caseData.id ? caseData.id.slice(-6) : ''}}
      </view>
      <view class="case-status">
        <text class="badge {{caseData.status === 'completed' ? 'badge-success' : 'badge-warning'}}">
          {{caseData.status === 'completed' ? 'å·²å®Œæˆ' : 'è‰ç¨¿'}}
        </text>
      </view>
    </view>
    <view class="case-meta">
      <view class="meta-item">
        <text class="meta-label">åˆ›å»ºæ—¶é—´ï¼š</text>
        <text class="meta-value">{{createTimeText}}</text>
      </view>
      <view class="meta-item" wx:if="{{updateTimeText !== createTimeText}}">
        <text class="meta-label">æ›´æ–°æ—¶é—´ï¼š</text>
        <text class="meta-value">{{updateTimeText}}</text>
      </view>
    </view>
  </view>

  <!-- åŸºæœ¬ä¿¡æ¯ -->
  <view class="section-card card">
    <view class="section-header">
      <view class="section-title">åŸºæœ¬ä¿¡æ¯</view>
      <view class="section-icon">ğŸ‘¤</view>
    </view>
    <view class="section-content">
      <view class="info-row">
        <view class="info-label">æ€§åˆ«</view>
        <view class="info-value">{{caseData.basicInfo.gender || 'æœªå¡«å†™'}}</view>
      </view>
      <view class="info-row">
        <view class="info-label">å¹´é¾„</view>
        <view class="info-value">{{caseData.basicInfo.age ? caseData.basicInfo.age + 'å²' : 'æœªå¡«å†™'}}</view>
      </view>
    </view>
  </view>

  <!-- ç—‡çŠ¶ä¿¡æ¯ -->
  <view class="section-card card">
    <view class="section-header">
      <view class="section-title">ç—‡çŠ¶ä¿¡æ¯</view>
      <view class="section-icon">ğŸ“‹</view>
    </view>
    <view class="section-content">
      <view class="info-row">
        <view class="info-label">ç—‡çŠ¶å‡ºç°æ—¶é—´</view>
        <view class="info-value">
          {{caseData.symptoms.duration && caseData.symptoms.durationUnit ? 
            caseData.symptoms.duration + caseData.symptoms.durationUnit : 'æœªå¡«å†™'}}
        </view>
      </view>
    </view>
  </view>

  <!-- åˆå¹¶ç–¾ç—… -->
  <view class="section-card card" wx:if="{{caseData.comorbidities.length > 0}}">
    <view class="section-header">
      <view class="section-title">åˆå¹¶ç–¾ç—…</view>
      <view class="section-icon">ğŸ¥</view>
    </view>
    <view class="section-content">
      <view class="tag-list">
        <view class="tag" wx:for="{{caseData.comorbidities}}" wx:key="index">
          {{item}}
        </view>
      </view>
    </view>
  </view>

  <!-- æ—¢å¾€ç—…å² -->
  <view class="section-card card" wx:if="{{caseData.pastHistory.length > 0}}">
    <view class="section-header">
      <view class="section-title">æ—¢å¾€ç—…å²</view>
      <view class="section-icon">ğŸ“œ</view>
    </view>
    <view class="section-content">
      <view class="tag-list">
        <view class="tag" wx:for="{{caseData.pastHistory}}" wx:key="index">
          {{item}}
        </view>
      </view>
    </view>
  </view>

  <!-- å½±åƒå­¦æŠ¥å‘Š -->
  <view class="section-card card">
    <view class="section-header">
      <view class="section-title">å½±åƒå­¦æŠ¥å‘Š</view>
      <view class="section-icon">ğŸ–¼ï¸</view>
    </view>
    <view class="section-content">
      <!-- æŠ¥å‘Šæ–‡ä»¶ -->
      <view class="file-section" wx:if="{{caseData.imagingReport.files.length > 0}}">
        <view class="subsection-title">æŠ¥å‘Šæ–‡ä»¶</view>
        <view class="file-grid">
          <view class="file-item" 
                wx:for="{{caseData.imagingReport.files}}" wx:key="index"
                bindtap="previewFile" data-url="{{item.path}}">
            <view class="file-preview">
              <image class="file-image" src="{{item.path}}" mode="aspectFill" wx:if="{{item.type === 'image'}}" />
              <view class="file-pdf" wx:if="{{item.type === 'pdf'}}">
                <text class="pdf-icon">ğŸ“„</text>
                <text class="pdf-text">PDF</text>
              </view>
            </view>
            <view class="file-name">{{item.name}}</view>
          </view>
        </view>
      </view>

      <!-- è¯¦ç»†æŠ¥å‘Š -->
      <view class="text-section" wx:if="{{caseData.imagingReport.detailReport}}">
        <view class="subsection-title">è¯¦ç»†æŠ¥å‘Š</view>
        <view class="text-content">{{caseData.imagingReport.detailReport}}</view>
      </view>

      <!-- æ£€æŸ¥ç»“è®º -->
      <view class="text-section" wx:if="{{caseData.imagingReport.conclusion}}">
        <view class="subsection-title">æ£€æŸ¥ç»“è®º</view>
        <view class="text-content">{{caseData.imagingReport.conclusion}}</view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-section" wx:if="{{!caseData.imagingReport.files.length && !caseData.imagingReport.detailReport && !caseData.imagingReport.conclusion}}">
        <text class="empty-text">æš‚æ— å½±åƒå­¦æŠ¥å‘Š</text>
      </view>
    </view>
  </view>

  <!-- ç—…ç†æŠ¥å‘Š -->
  <view class="section-card card">
    <view class="section-header">
      <view class="section-title">ç—…ç†æŠ¥å‘Š</view>
      <view class="section-icon">ğŸ”¬</view>
    </view>
    <view class="section-content">
      <!-- æŠ¥å‘Šæ–‡ä»¶ -->
      <view class="file-section" wx:if="{{caseData.pathologyReport.files.length > 0}}">
        <view class="subsection-title">æŠ¥å‘Šæ–‡ä»¶</view>
        <view class="file-grid">
          <view class="file-item" 
                wx:for="{{caseData.pathologyReport.files}}" wx:key="index"
                bindtap="previewFile" data-url="{{item.path}}">
            <view class="file-preview">
              <image class="file-image" src="{{item.path}}" mode="aspectFill" wx:if="{{item.type === 'image'}}" />
              <view class="file-pdf" wx:if="{{item.type === 'pdf'}}">
                <text class="pdf-icon">ğŸ“„</text>
                <text class="pdf-text">PDF</text>
              </view>
            </view>
            <view class="file-name">{{item.name}}</view>
          </view>
        </view>
      </view>

      <!-- ç—…ç†è¯Šæ–­ -->
      <view class="text-section" wx:if="{{caseData.pathologyReport.diagnosis}}">
        <view class="subsection-title">ç—…ç†è¯Šæ–­</view>
        <view class="text-content">{{caseData.pathologyReport.diagnosis}}</view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-section" wx:if="{{!caseData.pathologyReport.files.length && !caseData.pathologyReport.diagnosis}}">
        <text class="empty-text">æš‚æ— ç—…ç†æŠ¥å‘Š</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œ -->
  <view class="footer-actions safe-area">
    <button class="btn btn-secondary" bindtap="editCase">ç¼–è¾‘ç—…ä¾‹</button>
    <button class="btn btn-primary" bindtap="shareCase">åˆ†äº«ç—…ä¾‹</button>
    <button class="btn btn-danger" bindtap="deleteCase">åˆ é™¤ç—…ä¾‹</button>
  </view>
</view>

<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading-overlay" wx:if="{{isLoading}}">
  <view class="loading">
    <view class="loading-spinner"></view>
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>
</view>
